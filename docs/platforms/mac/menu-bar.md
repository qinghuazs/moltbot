---
summary: "èœå•æ çŠ¶æ€é€»è¾‘ä»¥åŠå¯¹ç”¨æˆ·å¯è§çš„å†…å®¹"
read_when:
  - è°ƒæ•´ mac èœå• UI æˆ–çŠ¶æ€é€»è¾‘
---
# èœå•æ çŠ¶æ€é€»è¾‘

## å±•ç¤ºå†…å®¹
- åœ¨èœå•æ å›¾æ ‡ä¸èœå•çš„ç¬¬ä¸€è¡ŒçŠ¶æ€ä¸­å±•ç¤ºå½“å‰ agent çš„å·¥ä½œçŠ¶æ€ã€‚
- å½“æœ‰å·¥ä½œè¿›è¡Œæ—¶éšè—å¥åº·çŠ¶æ€ï¼›æ‰€æœ‰ä¼šè¯ç©ºé—²åæ¢å¤ã€‚
- èœå•ä¸­çš„ â€œNodesâ€ åŒºå—ä»…åˆ—å‡º**è®¾å¤‡**ï¼ˆé€šè¿‡ `node.list` çš„å·²é…å¯¹èŠ‚ç‚¹ï¼‰ï¼Œä¸æ˜¾ç¤º client/presence æ¡ç›®ã€‚
- å½“æœ‰æä¾›æ–¹ç”¨é‡å¿«ç…§æ—¶ï¼ŒContext ä¸‹ä¼šæ˜¾ç¤º â€œUsageâ€ åŒºå—ã€‚

## çŠ¶æ€æ¨¡å‹
- ä¼šè¯ï¼šäº‹ä»¶æºå¸¦ `runId`ï¼ˆå•æ¬¡è¿è¡Œï¼‰ä¸ payload ä¸­çš„ `sessionKey`ã€‚â€œmainâ€ ä¼šè¯é”®ä¸º `main`ï¼›è‹¥ç¼ºå¤±åˆ™å›é€€åˆ°æœ€è¿‘æ›´æ–°çš„ä¼šè¯ã€‚
- ä¼˜å…ˆçº§ï¼šmain æ°¸è¿œä¼˜å…ˆã€‚è‹¥ main æ´»è·ƒï¼Œç«‹å³æ˜¾ç¤ºå…¶çŠ¶æ€ï¼›è‹¥ main ç©ºé—²ï¼Œæ˜¾ç¤ºæœ€è¿‘æ´»è·ƒçš„é main ä¼šè¯ã€‚ä¸ä¼šåœ¨æ´»åŠ¨ä¸­æ¥å›åˆ‡æ¢ï¼›åªåœ¨å½“å‰ä¼šè¯ç©ºé—²æˆ– main å˜ä¸ºæ´»è·ƒæ—¶åˆ‡æ¢ã€‚
- æ´»åŠ¨ç±»å‹ï¼š
  - `job`ï¼šé«˜å±‚å‘½ä»¤æ‰§è¡Œï¼ˆ`state: started|streaming|done|error`ï¼‰ã€‚
  - `tool`ï¼š`phase: start|result`ï¼Œæºå¸¦ `toolName` ä¸ `meta/args`ã€‚

## IconState æšä¸¾ï¼ˆSwiftï¼‰
- `idle`
- `workingMain(ActivityKind)`
- `workingOther(ActivityKind)`
- `overridden(ActivityKind)`ï¼ˆè°ƒè¯•è¦†ç›–ï¼‰

### ActivityKind â†’ å›¾æ ‡
- `exec` â†’ ğŸ’»
- `read` â†’ ğŸ“„
- `write` â†’ âœï¸
- `edit` â†’ ğŸ“
- `attach` â†’ ğŸ“
- é»˜è®¤ â†’ ğŸ› ï¸

### è§†è§‰æ˜ å°„
- `idle`ï¼šæ­£å¸¸å°é¾™è™¾ã€‚
- `workingMain`ï¼šå¸¦å›¾æ ‡å¾½ç« ï¼Œå®Œæ•´ç€è‰²ï¼Œè…¿éƒ¨â€œå·¥ä½œä¸­â€åŠ¨ç”»ã€‚
- `workingOther`ï¼šå¸¦å›¾æ ‡å¾½ç« ï¼Œå¼±åŒ–è‰²è°ƒï¼Œæ— ç–¾è·‘åŠ¨ç”»ã€‚
- `overridden`ï¼šæ— è®ºæ´»åŠ¨çŠ¶æ€éƒ½ä½¿ç”¨æŒ‡å®šå›¾æ ‡/è‰²è°ƒã€‚

## çŠ¶æ€è¡Œæ–‡æœ¬ï¼ˆèœå•ï¼‰
- å·¥ä½œè¿›è¡Œä¸­ï¼š`<Session role> Â· <activity label>`
  - ç¤ºä¾‹ï¼š`Main Â· exec: pnpm test`ã€`Other Â· read: apps/macos/Sources/Moltbot/AppState.swift`ã€‚
- ç©ºé—²æ—¶ï¼šå›é€€ä¸ºå¥åº·æ‘˜è¦ã€‚

## äº‹ä»¶æ‘„å–
- æ¥æºï¼šcontrol-channel çš„ `agent` äº‹ä»¶ï¼ˆ`ControlChannel.handleAgentEvent`ï¼‰ã€‚
- è§£æå­—æ®µï¼š
  - `stream: "job"`ï¼Œå¸¦ `data.state` è¡¨ç¤ºå¼€å§‹/ç»“æŸã€‚
  - `stream: "tool"`ï¼Œå¸¦ `data.phase`ã€`name`ã€å¯é€‰ `meta`/`args`ã€‚
- æ ‡ç­¾ï¼š
  - `exec`ï¼š`args.command` çš„é¦–è¡Œã€‚
  - `read`/`write`ï¼šç¼©çŸ­åçš„è·¯å¾„ã€‚
  - `edit`ï¼šè·¯å¾„ + ä» `meta`/diff è®¡æ•°æ¨æ–­çš„å˜æ›´ç±»å‹ã€‚
  - å…œåº•ï¼šå·¥å…·åã€‚

## è°ƒè¯•è¦†ç›–
- è®¾ç½® â–¸ Debug â–¸ â€œIcon overrideâ€ é€‰æ‹©å™¨ï¼š
  - `System (auto)`ï¼ˆé»˜è®¤ï¼‰
  - `Working: main`ï¼ˆæŒ‰å·¥å…·ç±»å‹ï¼‰
  - `Working: other`ï¼ˆæŒ‰å·¥å…·ç±»å‹ï¼‰
  - `Idle`
- å­˜å‚¨äº `@AppStorage("iconOverride")`ï¼›æ˜ å°„ä¸º `IconState.overridden`ã€‚

## æµ‹è¯•æ¸…å•
- è§¦å‘ main ä¼šè¯ jobï¼šå›¾æ ‡åº”ç«‹å³åˆ‡æ¢ä¸”çŠ¶æ€è¡Œæ˜¾ç¤º main æ ‡ç­¾ã€‚
- main ç©ºé—²æ—¶è§¦å‘é main ä¼šè¯ jobï¼šå›¾æ ‡/çŠ¶æ€æ˜¾ç¤ºé mainï¼Œå¹¶ä¿æŒç¨³å®šç›´åˆ°ç»“æŸã€‚
- å…¶ä»–ä¼šè¯æ´»è·ƒæ—¶å¯åŠ¨ mainï¼šå›¾æ ‡åº”ç«‹å³åˆ‡åˆ° mainã€‚
- å·¥å…·å¿«é€Ÿçªå‘ï¼šå¾½ç« ä¸åº”é—ªçƒï¼ˆtool ç»“æœæœ‰ TTL å®½é™ï¼‰ã€‚
- æ‰€æœ‰ä¼šè¯ç©ºé—²åå¥åº·è¡Œåº”æ¢å¤ã€‚
